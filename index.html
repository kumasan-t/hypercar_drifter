<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="./js/hand.minified-1.2.js"></script>
        <script src="./js/cannon.js"></script>  <!-- optional -->
        <script src="./js/oimo.js"></script>  <!-- optional -->
        <script src="./js/babylon.js"></script>
        <script src="./js/direction.js"></script>
        <script src="./js/obstacles.js"></script>
        
        <style>
            html,body{
                position:relative;
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            
            #renderCanvas{
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                margin-left: auto;
                margin-right: auto;
                bottom: 0;
                
                margin-top: auto;
                margin-bottom: auto;
                width: 1066px;
                height: 600px;
                touch-action: none;
            }
        </style>
    </head>
    <body>
        <canvas id="renderCanvas"></canvas>
        <script>
            var canvas = document.getElementById("renderCanvas");
            var engine = new BABYLON.Engine(canvas, true);
            var car;
            var speed = 10;
            var obstacles_manager = new Obstacles(-15);
            var loaded = false;
            
            var keys={
                left:0,
                right:0,
                up:0,
                down:0
            };
            window.addEventListener("keydown", handleKeyDown, false);
            window.addEventListener("keyup", handleKeyUp, false);
            function handleKeyDown(evt){    
                if (evt.keyCode==65){
                    //A        
                    keys.left=1;    
                }    
                if (evt.keyCode==68){//D        
                    keys.right=1;    
                }    
                if (evt.keyCode==87){//W        
                    keys.up=1;    
                }    if (evt.keyCode==83){//S        
                    keys.down=1;    
                }
            }
            
            function handleKeyUp(evt){    
                if (evt.keyCode==65){        
                    keys.left=0;    
                }    
                if (evt.keyCode==68){        
                    keys.right=0;    
                }    
                if (evt.keyCode==87){        
                    keys.up=0;    
                }    if (evt.keyCode==83){        
                    keys.down=0;    
                }
            }
            
            var createScene = function(){
                var scene = new BABYLON.Scene(engine);
                scene.clearColor = new BABYLON.Color3(0,0,0.2);
                
                
                //camera.attachControl(canvas,false);
                
                var light = new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0,1,0), scene);
                light.groundColor = new BABYLON.Color3(0.5,0,0.5);
                
                light.intensity = 1;
                BABYLON.SceneLoader.ImportMesh("", "assets/", "supercar.babylon", scene, function(meshes){
                    car = meshes[0];
                    car.rotation.y = -Math.PI/2;
                    car.xDirection = 0;
                    car.yDirection = 0;
                    car.scaling = new BABYLON.Vector3(.25,.25,.25);
                    loaded = true;
                    
                    var camera = new BABYLON.FreeCamera("FreeCamera", new BABYLON.Vector3(0, 0, -5), scene);
                });                
                
                return scene;
            };
            
            
            
            var scene = createScene();
            var i = 0;
            engine.runRenderLoop(function(){
                if(loaded){
                var xMovement =0,yMovement = 0;
                if(keys.left == 1)
                    xMovement += 1;
                if(keys.right == 1)
                    xMovement -= 1;
                if(keys.up == 1)
                    yMovement += 1;
                if(keys.down == 1)
                    yMovement -= 1;
                updateRotation(car, 1/engine.fps, xMovement, yMovement);
                
                car.position.x-= speed/engine.fps * car.xDirection;
                car.position.y+= speed/engine.fps * car.yDirection;
                
                if (car.position.x > 3 ) {
                    car.position.x = 3;
                }
                if (car.position.y > 1.5 ) {
                    car.position.y = 1.5;
                }
                if (car.position.x < -3) {
                    car.position.x = -3;
                }
               
                if (car.position.y < -1.5) {
                    car.position.y = -1.5;
                }
                
                obstacles_manager.update(3, 1/engine.fps);
                obstacles_manager.despawn();
                obstacles_manager.spawn(scene, 1/engine.fps);
                
                scene.render();
                }
                
                
            });
            
            window.addEventListener("resize", function(){
                engine.resize();
            });
        </script>
    </body>
</html>
